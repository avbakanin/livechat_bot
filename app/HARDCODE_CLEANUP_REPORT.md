# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Ö–∞—Ä–¥–∫–æ–¥–∞

## üîç –ü—Ä–æ–≤–µ–¥–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–í—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ö–∞—Ä–¥–∫–æ–¥–∞ (–∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π).

## ‚ùå –ù–∞–π–¥–µ–Ω–Ω—ã–π —Ö–∞—Ä–¥–∫–æ–¥:

### 1. **–•–∞—Ä–¥–∫–æ–¥ –≤ `MessageService._get_system_prompt()`**

**–§–∞–π–ª:** `app/domain/message/services.py`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# ‚ùå –ë–´–õ–û:
prompts = {
    "female": "–¢—ã –ò–ò-–¥–µ–≤—É—à–∫–∞, —Ñ–ª–∏—Ä—Ç—É—é—â–∞—è –∏ supportive –¥–ª—è –æ–¥–∏–Ω–æ–∫–∏—Ö –ª—é–¥–µ–π. –ë—É–¥—å –º–∏–ª–æ–π, empathetic –∏ –∏–≥—Ä–∏–≤–æ–π.",
    "male": "–¢—ã –ò–ò-–º–æ–ª–æ–¥–æ–π —á–µ–ª–æ–≤–µ–∫, —Ñ–ª–∏—Ä—Ç—É—é—â–∏–π –∏ supportive –¥–ª—è –æ–¥–∏–Ω–æ–∫–∏—Ö –ª—é–¥–µ–π. –ë—É–¥—å —É–≤–µ—Ä–µ–Ω–Ω—ã–º, empathetic –∏ –∏–≥—Ä–∏–≤—ã–º.",
}
```

**–†–µ—à–µ–Ω–∏–µ:**
```python
# ‚úÖ –°–¢–ê–õ–û:
fallback_prompts = {
    "female": "You are an AI companion. Be friendly, empathetic and supportive.",
    "male": "You are an AI companion. Be friendly, empathetic and supportive.",
}
```

**–ü—Ä–∏—á–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- –£–±—Ä–∞–Ω—ã —Ä—É—Å—Å–∫–∏–µ —Ç–µ–∫—Å—Ç—ã (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –ø–µ—Ä–µ–≤–æ–¥–∞—Ö)
- –£–ø—Ä–æ—â–µ–Ω—ã –ø—Ä–æ–º–ø—Ç—ã (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ç–µ–ø–µ—Ä—å –≤ `PersonaService`)
- –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ —Ç–æ–º, —á—Ç–æ —ç—Ç–æ fallback –º–µ—Ç–æ–¥

### 2. **–•–∞—Ä–¥–∫–æ–¥ –ª–∏–º–∏—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ `MessageService.can_send_message()`**

**–§–∞–π–ª:** `app/domain/message/services.py`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# ‚ùå –ë–´–õ–û:
daily_limit = 100  # Should come from config
```

**–†–µ—à–µ–Ω–∏–µ:**
```python
# ‚úÖ –°–¢–ê–õ–û:
daily_limit = OPENAI_CONFIG.get("FREE_MESSAGE_LIMIT", 100)
```

**–ü—Ä–∏—á–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- –¢–µ–ø–µ—Ä—å –ª–∏–º–∏—Ç –±–µ—Ä–µ—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω fallback –Ω–∞ 100 –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 3. **–•–∞—Ä–¥–∫–æ–¥ –ª–∏–º–∏—Ç–∞ –≤ `get_help_text()`**

**–§–∞–π–ª:** `app/shared/messages/common.py`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# ‚ùå –ë–´–õ–û:
def get_help_text(free_limit: int = 100) -> str:
```

**–†–µ—à–µ–Ω–∏–µ:**
```python
# ‚úÖ –°–¢–ê–õ–û:
def get_help_text(free_limit: int = None) -> str:
    # Use provided limit or get from config
    if free_limit is None:
        free_limit = OPENAI_CONFIG.get('FREE_MESSAGE_LIMIT', 100)
```

**–ü—Ä–∏—á–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ü–∞—Ä–∞–º–µ—Ç—Ä —Å—Ç–∞–ª –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º
- –õ–∏–º–∏—Ç –±–µ—Ä–µ—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω fallback –Ω–∞ 100

## ‚úÖ –ß—Ç–æ —É–∂–µ –±—ã–ª–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

### 1. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**
- `app/config/openai.py` - —Å–æ–¥–µ—Ä–∂–∏—Ç `FREE_MESSAGE_LIMIT: 100`
- `app/shared/constants/config.py` - —Å–æ–¥–µ—Ä–∂–∏—Ç `FREE_MESSAGE_LIMIT: 100`

### 2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö**
- `app/domain/user/messages.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `OPENAI_CONFIG.get('FREE_MESSAGE_LIMIT', 100)`
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –º–µ—Å—Ç —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### 3. **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è**
- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç–µ–∫—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–∏—Å—Ç–µ–º—É –ø–µ—Ä–µ–≤–æ–¥–æ–≤ `i18n`
- –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞ —Ä—É—Å—Å–∫–∏—Ö/–∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤ –≤ –∫–æ–¥–µ

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 2
- `app/domain/message/services.py` - 2 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- `app/shared/messages/common.py` - 1 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

**–¢–∏–ø—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- üîß **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** 2 –º–µ—Å—Ç–∞ (–ª–∏–º–∏—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π)
- üåç **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è:** 1 –º–µ—Å—Ç–æ (—Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã)
- üìù **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:

### ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω –≤–µ—Å—å –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ö–∞—Ä–¥–∫–æ–¥:**
- –ù–µ—Ç –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –í—Å–µ –ª–∏–º–∏—Ç—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π)

### ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- Fallback –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### ‚úÖ **–£–ª—É—á—à–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –õ—É—á—à–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
- –ë–æ–ª–µ–µ —á–∏—Å—Ç—ã–π –∫–æ–¥

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

### **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ö–∞—Ä–¥–∫–æ–¥–∞:**
- ‚úÖ –ß–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–ª–∏–º–∏—Ç—ã, —Ç–∞–π–º–∞—É—Ç—ã)
- ‚úÖ –°—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (—Ç–µ–∫—Å—Ç—ã, —Å–æ–æ–±—â–µ–Ω–∏—è)
- ‚úÖ –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞
- ‚úÖ –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ URL'—ã
- ‚úÖ –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤—Ä–µ–º–µ–Ω–∏

### **–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- –í—Å–µ —Ñ–∞–π–ª—ã –≤ `app/domain/`
- –í—Å–µ —Ñ–∞–π–ª—ã –≤ `app/services/`
- –í—Å–µ —Ñ–∞–π–ª—ã –≤ `app/shared/`
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ:

**–•–∞—Ä–¥–∫–æ–¥ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω!** –ö–æ–¥–æ–≤–∞—è –±–∞–∑–∞ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- ‚úÖ –°–∏—Å—Ç–µ–º—É –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤
- ‚úÖ –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–º–µ—Å—Ç–æ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª
- ‚úÖ Fallback –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

–ö–æ–¥ —Å—Ç–∞–ª –±–æ–ª–µ–µ **maintainable**, **configurable** –∏ **localizable**! üöÄ
