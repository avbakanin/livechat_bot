# –û—Ç–ª–∞–¥–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Message Handlers

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤ `app/domain/message/handlers.py` –¥–ª—è –∞–¥–º–∏–Ω–æ–≤.

## üéØ **–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–ª–∞–¥–∫–∏**

### 1. **–ö–æ–º–∞–Ω–¥–∞ `/debug_msg`**
- **–î–æ—Å—Ç—É–ø**: –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞ (ID: 627875032)
- **–§—É–Ω–∫—Ü–∏—è**: –ü–æ–ª–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ —Å–æ–æ–±—â–µ–Ω–∏–∏
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/debug_msg` –≤ —á–∞—Ç

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- üìä –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î –∏ –∫—ç—à–∞
- üìù –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–æ–±—â–µ–Ω–∏–∏ (ID, –¥–ª–∏–Ω–∞, –ø—Ä–µ–≤—å—é, —á–∞—Ç)
- ‚öôÔ∏è –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã (–ª–∏–º–∏—Ç—ã, —Å–æ–≥–ª–∞—Å–∏–µ, —è–∑—ã–∫, –ø–æ–ª)
- üî¢ –û—Å—Ç–∞–≤—à–∏–µ—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è

### 2. **–û—Ç–ª–∞–¥–∫–∞ –æ—à–∏–±–æ–∫**
–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ –∞–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:

**OpenAI –æ—à–∏–±–∫–∏:**
- –¢–∏–ø –æ—à–∏–±–∫–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏

**Database –æ—à–∏–±–∫–∏:**
- –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –û–ø–µ—Ä–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑–≤–∞–ª–∞ –æ—à–∏–±–∫—É
- –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å–∫–ª—é—á–µ–Ω–∏–∏
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 3. **–û—Ç–ª–∞–¥–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
**–§–ª—É–¥-–¥–µ—Ç–µ–∫—Ü–∏—è:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—ã—Å—Ç—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

**–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤:**
- –°—Ç–∞—Ç—É—Å –ª–∏–º–∏—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å–æ–æ–±—â–µ–Ω–∏–π
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è

## üöÄ **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**

### **–î–ª—è –∞–¥–º–∏–Ω–∞:**
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/debug_msg` - –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
2. –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç–µ –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
3. –ü—Ä–∏ —Ñ–ª—É–¥–µ –∏–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤ —É–≤–∏–¥–∏—Ç–µ –¥–µ—Ç–∞–ª–∏

### **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:**
```python
# –í –∫–æ–¥–µ —É–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ:
from shared.metrics.debug_info import get_user_debug_info, get_error_debug_info, get_general_debug_info

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö:
if user_id == ADMIN_ID:
    debug_info = get_user_debug_info(user_id, user, cached_user)
    await message.answer(debug_info)
```

## üìä **–ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞**

### **–ö–æ–º–∞–Ω–¥–∞ `/debug_msg`:**
```
üîç Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 627875032:

üìä –î–∞–Ω–Ω—ã–µ –∏–∑ –ë–î:
  ID: 627875032
  Username: admin
  First Name: Admin
  Language: ru
  Gender Preference: female
  Subscription Status: premium
  Consent Given: True
  ...

üîç –û—Ç–ª–∞–¥–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:

  message_id: 12345
  text_length: 25
  text_preview: /debug_msg
  chat_id: 627875032
  chat_type: private
  can_send_message: True
  remaining_messages: 50
  consent_given: True
  gender_preference: female
  user_language: ru
```

### **–û—Ç–ª–∞–¥–∫–∞ –æ—à–∏–±–∫–∏:**
```
üîç Debug OpenAI Error:

‚ùå Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ:

  –¢–∏–ø –æ—à–∏–±–∫–∏: OpenAIException
  –°–æ–æ–±—â–µ–Ω–∏–µ: Rate limit exceeded

  –ö–æ–Ω—Ç–µ–∫—Å—Ç:
    user_id: 627875032
    message_text: –ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?
    error_type: OpenAIException
    response_time: 2.5
```

## üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**

- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –û—Ç–ª–∞–¥–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—É
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –æ—à–∏–±–∫–∏ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ–±—ã—á–Ω—É—é —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞

## üé® **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**

–ú–æ–¥—É–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `shared/metrics/debug_info`:
- `get_user_debug_info()` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- `get_error_debug_info()` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö  
- `get_general_debug_info()` - –æ–±—â–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤–æ –≤—Å–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏! üéâ
