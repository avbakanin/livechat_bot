# üõë –ê–Ω–∞–ª–∏–∑ –∫–æ–º–∞–Ω–¥—ã /stop

## üìã –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞ /stop

### 1. **–ò–Ω–∏—Ü–∏–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã**
```python
@router.message(Command(commands=[BotCommands.STOP]))
async def cmd_stop(message: Message, i18n: I18nMiddleware, cached_user: UserCacheData = None):
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É `/stop`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ñ–ª–∞–≥ `cached_user.is_stopped` - –µ—Å–ª–∏ –±–æ—Ç —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- –ï—Å–ª–∏ –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

### 2. **–î–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è**
```html
üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞

–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞?

–í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã:
‚Ä¢ –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏
‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚Ä¢ –ö—ç—à

–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!
```

**–ö–Ω–æ–ø–∫–∏:**
- ‚úÖ **–î–∞** (`stop_confirm`)
- ‚ùå **–ù–µ—Ç** (`stop_cancel`)
- ‚Ü©Ô∏è **–ù–∞–∑–∞–¥ –∫ —Å–ø—Ä–∞–≤–∫–µ** (`back_to_help`)

### 3. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**
```python
async def stop_confirm(callback: CallbackQuery, user_service: UserService, i18n: I18nMiddleware):
    await user_service.reset_user_state(user_id)
```

## üóÑÔ∏è –ß—Ç–æ —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### **–§—É–Ω–∫—Ü–∏—è `reset_user_state(user_id)`:**
```python
async def reset_user_state(self, user_id: int) -> None:
    """Reset user state completely - delete user from database."""
```

### **1. –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π**
```sql
DELETE FROM messages WHERE user_id = $1
```
- **–¢–∞–±–ª–∏—Ü–∞:** `messages`
- **–ß—Ç–æ —É–¥–∞–ª—è–µ—Ç—Å—è:** –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏)
- **–§—É–Ω–∫—Ü–∏—è:** `delete_user_messages(user_id)`

### **2. –ü–û–õ–ù–û–ï —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
```sql
DELETE FROM users WHERE id = $1
```
- **–¢–∞–±–ª–∏—Ü–∞:** `users`
- **–ß—Ç–æ —É–¥–∞–ª—è–µ—Ç—Å—è:** –í–°–Ø –∑–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–§—É–Ω–∫—Ü–∏—è:** `delete_user(user_id)`

### **3. –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞**
```python
await user_cache.invalidate(user_id)
```
- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∫—ç—à–∞ FSM
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω –∏–∑ —Å–∏—Å—Ç–µ–º—ã

## üî• –ß—Ç–æ —É–¥–∞–ª—è–µ—Ç—Å—è –ü–û–õ–ù–û–°–¢–¨–Æ

### **–¢–∞–±–ª–∏—Ü–∞ `users` - –í–°–Ø –∑–∞–ø–∏—Å—å:**
- ‚ùå **ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (`id`)
- ‚ùå **–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (`username`)
- ‚ùå **–ò–º—è** (`first_name`)
- ‚ùå **–§–∞–º–∏–ª–∏—è** (`last_name`)
- ‚ùå **–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ –ø–æ–ª–∞** (`gender_preference`)
- ‚ùå **–Ø–∑—ã–∫** (`language`)
- ‚ùå **–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏** (`subscription_status`)
- ‚ùå **–°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É** (`consent_given`)
- ‚ùå **–î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏** (`subscription_expires_at`)
- ‚ùå **–ü—Ä–æ—Ñ–∏–ª—å –ª–∏—á–Ω–æ—Å—Ç–∏** (`personality_profile`)
- ‚ùå **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è** (`created_at`)
- ‚ùå **–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** (`updated_at`)

### **–¢–∞–±–ª–∏—Ü–∞ `messages` - –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è:**
- ‚ùå **–í—Å—è –∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### **–ö—ç—à FSM:**
- ‚ùå **–í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –≤ –ø–∞–º—è—Ç–∏

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –ø–æ—Å–ª–µ /stop

### **–¢–∞–±–ª–∏—Ü–∞ `users`:**
```sql
-- –ó–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ü–û–õ–ù–û–°–¢–¨–Æ —É–¥–∞–ª–µ–Ω–∞
-- –ù–∏–∫–∞–∫–∏—Ö —Å–ª–µ–¥–æ–≤ –Ω–µ –æ—Å—Ç–∞–µ—Ç—Å—è
```

### **–¢–∞–±–ª–∏—Ü–∞ `messages`:**
```sql
-- –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª–µ–Ω—ã
-- –ù–∏–∫–∞–∫–∏—Ö —Å–ª–µ–¥–æ–≤ –Ω–µ –æ—Å—Ç–∞–µ—Ç—Å—è
```

## üéØ –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π –ø–æ—Å–ª–µ stop

### **1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞:**
```python
cached_data.is_stopped = True
cached_data.is_restarted = False  # Reset restart state
await user_cache.set(user_id, cached_data)
```

### **2. –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ:**
```
üëã –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã. –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!

üò¢ –ù–∞–º –∂–∞–ª—å, —á—Ç–æ –≤—ã —É—Ö–æ–¥–∏—Ç–µ. –ú—ã –±—É–¥–µ–º –∂–¥–∞—Ç—å –≤–∞—à–µ–≥–æ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è!
```

### **3. –ö–æ–Ω–µ—Ü –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–æ–ª—å—à–µ –Ω–µ –º–æ–∂–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –±–æ—Ç–æ–º
- –î–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/start` –∑–∞–Ω–æ–≤–æ

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### **1. –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–∞ `is_stopped` –≤ –∫—ç—à–µ
- –ï—Å–ª–∏ —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

### **2. –ù–ï–û–ë–†–ê–¢–ò–ú–û–°–¢–¨:**
- **–í–°–ï –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞**
- **–ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è**
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "–Ω–æ–≤—ã–º"**

### **3. –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:**
- –£–¥–∞–ª—è–µ—Ç—Å—è –í–°–Ø –∑–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
- –£–¥–∞–ª—è—é—Ç—Å—è –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è
- –û—á–∏—â–∞–µ—Ç—Å—è –≤–µ—Å—å –∫—ç—à

## üîÑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ /restart vs /stop

| –ü–∞—Ä–∞–º–µ—Ç—Ä | /restart | /stop |
|----------|----------|-------|
| **–°–æ–æ–±—â–µ–Ω–∏—è** | ‚ùå –£–¥–∞–ª—è—é—Ç—Å—è | ‚ùå –£–¥–∞–ª—è—é—Ç—Å—è |
| **–ü–æ–ª –∫–æ–º–ø–∞–Ω—å–æ–Ω–∞** | ‚ùå –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è | ‚ùå –£–¥–∞–ª—è–µ—Ç—Å—è |
| **–ü—Ä–æ—Ñ–∏–ª—å –ª–∏—á–Ω–æ—Å—Ç–∏** | ‚ùå –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è | ‚ùå –£–¥–∞–ª—è–µ—Ç—Å—è |
| **–°–æ–≥–ª–∞—Å–∏–µ** | ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è | ‚ùå –£–¥–∞–ª—è–µ—Ç—Å—è |
| **–ü–æ–¥–ø–∏—Å–∫–∞** | ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è | ‚ùå –£–¥–∞–ª—è–µ—Ç—Å—è |
| **–Ø–∑—ã–∫** | ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è | ‚ùå –£–¥–∞–ª—è–µ—Ç—Å—è |
| **–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** | ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è | ‚ùå –£–¥–∞–ª—è—é—Ç—Å—è |
| **–ó–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** | ‚úÖ –û—Å—Ç–∞–µ—Ç—Å—è | ‚ùå –£–¥–∞–ª—è–µ—Ç—Å—è |
| **–†–µ–∑—É–ª—å—Ç–∞—Ç** | –í—ã–±–æ—Ä –ø–æ–ª–∞ | –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ |

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–ª–∏—á–∏—è

### **/restart - –ú—è–≥–∫–∏–π —Å–±—Ä–æ—Å:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –í–æ–∑–≤—Ä–∞—Ç –∫ –≤—ã–±–æ—Ä—É –ø–æ–ª–∞

### **/stop - –ñ–µ—Å—Ç–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç—Å—è
- –ù–∏—á–µ–≥–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- –¢—Ä–µ–±—É–µ—Ç –Ω–æ–≤–æ–≥–æ `/start`

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ö–æ–º–∞–Ω–¥–∞ `/stop` –≤—ã–ø–æ–ª–Ω—è–µ—Ç **–∂–µ—Å—Ç–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- **–£–¥–∞–ª—è–µ—Ç:** –í–°–ï –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–≤—Å–µ–≥–¥–∞
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "–Ω–æ–≤—ã–º" –∏ –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∞—Ç—å —Å `/start`

–≠—Ç–æ **–Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ** - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–µ—Ä—è—é—Ç—Å—è –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `/restart`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, `/stop` –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–∏—Å—Ç–µ–º—ã.

### **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- **/restart** - –¥–ª—è —Å–±—Ä–æ—Å–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏
- **/stop** - –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
